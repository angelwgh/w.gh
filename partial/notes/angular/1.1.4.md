## 控制器


AngularJS中的控制器是一个函数，用来向视图的作用域中添加额外的功能。我们用它来给
作用域对象设置初始状态，并添加自定义行为。

当我们在页面上创建一个新的控制器时， AngularJS会生成并传递一个新的`$scope`给这个控
制器。可以在这个控制器里初始化`$scope`。由于AngularJS会负责处理控制器的实例化过程，我
们只需编写构造函数即可。

```js
var app = angular.module('app', []);
app.controller('FirstController', function($scope) {
    $scope.message = "hello";
});
```


只需创建控制器作用域中的函数，就能创建可以在视图中使用的自定义操作。我们可以在视图中像调用普通数据一样调用$scope上的函数。

```html
<div ng-controller="FirstController">
    <h4>The simplest adding machine ever</h4>
    <button ng-click="add(1)" class="button">Add</button>
    <a ng-click="subtract(1)" class="button alert">Subtract</a>
    <h4>Current count: {{ counter }}</h4>
</div>
```

按钮和链接都被绑定在了内部`$scope`的一个操作上，当点击任何一个元素时AngularJS都会
调用相应的方法。注意，当设置调用哪个函数时，会同时用括号传递一个参数（`add(1)`）

给FirstController添加一个操作：

```js
app.controller('FirstController', function($scope) {
    $scope.counter = 0;
    $scope.add = function(amount) { $scope.counter += amount; };
    $scope.subtract = function(amount) { $scope.counter -= amount; };
});
```

用这种设置方式我们可以在视图中调用`add()`或`subtract()`方法，这两个方法可以定义在
`FirstController`的作用域中，或其父级的`$scope`中。

控制器可以将与一个独立视图相关的业务逻辑封装在一个独立的容器中。尽可能地精简控制
器是很好的做法。作为AngularJS开发者，使用依赖注入来访问服务可以实现这个目的。

AngularJS同其他JavaScript框架最主要的一个区别就是，控制器并不适合用来执行DOM操
作、格式化或数据操作，以及除存储数据模型之外的状态维护操作。它只是视图和$scope之间的桥梁。

AngularJS允许在`$scope`上设置包括对象在内的任何类型的数据，并且在视图中还可以展示
对象的属性。

例如，我们在`MyController`上创建一个`person`对象，这个对象只有`name`这一个属性：

```js
app.controller('MyController', function($scope) {
    $scope.person = {
        name: 'Ari Lerner'
    };
});
```

在拥有`ng-controller='MyController'`这个属性的元素内部的任何子元素中，都可以访问
`person`对象， 因为它是定义在`$scope`上的。可以方便地在视图中引用`person`或`person.name`，

```html
<div ng-app="myApp">
    <div ng-controller="MyController">
        <h1>{{ person }}</h1>
            and their name:
        <h2>{{ person.name }}</h2>
    </div>
</div>
```



###  控制器嵌套

AngularJS应用的任何一个部分，无论它渲染在哪个上下文中，都有父级作用域存在。对于
ng-app所处的层级来讲，它的父级作用域就是`$rootScope`。

> 有一个例外：在指令内部创建的作用域被称作孤立作用域。

除了孤立作用域外，所有的作用域都通过原型继承而来，也就是说它们都可以访问父级作用域。 

默认情况下， AngularJS在当前作用域中无法找到某个属性时，便会在父级作用域中进行查
找。如果AngularJS找不到对应的属性，会顺着父级作用域一直向上寻找，直到抵达`$rootScope`为止。如果在`$rootScope`中也找不到，程序会继续运行，但视图无法更新。


创建一个ParentController，其中包含一个user对象，再创
建一个ChildController来引用这个对象：

```js
app.controller('ParentController', function($scope) {
    $scope.person = {greeted: false};
});
app.controller('ChildController', function($scope) {
    $scope.sayHello = function() {
    $scope.person.name = 'Ari Lerner';
};
});

```

如果我们将ChildController置于ParentController内部，那ChildController的`$scope`
对象的父级作用域就是ParentController的`$scope`对象。根据原型继承的机制，我们可以在子作用域中访问ParentController的`$scope`对象。

```html
<div ng-controller="ParentController">
    <div ng-controller="ChildController">
        <a ng-click="sayHello()">Say hello</a>
    </div>
    {{ person }}
</div>
```
